# Railway Infrastructure as Code
# This file tells Railway to automatically provision all services

[build]
builder = "DOCKERFILE"
dockerfilePath = "Dockerfile"

[deploy]
numReplicas = 1
restartPolicyType = "ON_FAILURE"
restartPolicyMaxRetries = 10
healthcheckPath = "/health"
healthcheckTimeout = 100

# Backend service configuration
[[services]]
name = "backend"
source = "."

[services.build]
builder = "DOCKERFILE"
dockerfilePath = "Dockerfile"

[services.healthcheck]
path = "/health"
interval = 30
timeout = 10

# Evolution API service
[[services]]
name = "evolution-api"
image = "atendai/evolution-api:v2.2.2"

[services.healthcheck]
path = "/"
interval = 30
timeout = 10

# PostgreSQL database
[[services]]
name = "postgres"
type = "database"
provider = "postgresql"

# Redis cache
[[services]]
name = "redis"
type = "database"
provider = "redis"
